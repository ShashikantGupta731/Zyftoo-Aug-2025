{
    "sourceFile": "Ninico/components/admin/EditProductPage.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752833729959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752833729959,
            "name": "Commit-0",
            "content": "'use client'\r\n\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport { put } from '@/util/apiService'\r\nimport { PRODUCT } from '@/util/apiEndpoints'\r\n\r\nexport default function EditProductPage({ onNavigate }) {\r\n  const [activeTab, setActiveTab] = useState('basic')\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [uploadingImages, setUploadingImages] = useState({})\r\n  const [formData, setFormData] = useState({\r\n    // Basic Info\r\n    name: '',\r\n    short_description: '',\r\n    description: '',\r\n\r\n    // Pricing\r\n    price: '',\r\n    compare_price: '',\r\n    cost_price: '',\r\n    sale_price: '',\r\n    discount: '',\r\n\r\n    // Inventory\r\n    sku: '',\r\n    quantity: '',\r\n    stock_status: 'in_stock',\r\n    type: 'simple',\r\n    unit: '',\r\n    weight: '',\r\n    requires_shipping: true,\r\n    available_from: '',\r\n    available_to: '',\r\n\r\n    // Categories & Tags\r\n    categories: [],\r\n    tags: [],\r\n\r\n    // Images\r\n    images: [],\r\n    product_thumbnail_id: null,\r\n    product_galleries_id: [],\r\n    size_chart_image_id: null,\r\n\r\n    // SEO\r\n    meta_title: '',\r\n    meta_description: '',\r\n    product_meta_image_id: null,\r\n\r\n    // Shipping & Tax\r\n    is_free_shipping: false,\r\n    tax_status: 'taxable',\r\n    tax_class: '',\r\n\r\n    // Other\r\n    status: false,\r\n    featured: false,\r\n    manage_stock: false,\r\n    sold_individually: false,\r\n    reviews_allowed: true,\r\n    note: '',\r\n    purchase_note: '',\r\n    menu_order: 0,\r\n    enable_reviews: true,\r\n    track_quantity: false\r\n  })\r\n\r\n  // Load product data on component mount\r\n  useEffect(() => {\r\n    const productData = localStorage.getItem('editProduct')\r\n    if (productData) {\r\n      try {\r\n        const product = JSON.parse(productData)\r\n        setFormData({\r\n          ...formData,\r\n          ...product,\r\n          categories: product.categories || [],\r\n          tags: product.tags || [],\r\n          images: product.images || []\r\n        })\r\n      } catch (error) {\r\n        console.error('Error loading product data:', error)\r\n        setError('Failed to load product data')\r\n      }\r\n    } else {\r\n      setError('No product data found')\r\n    }\r\n  }, [])\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value, type, checked } = e.target\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: type === 'checkbox' ? checked : value\r\n    }))\r\n  }\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault()\r\n    setLoading(true)\r\n    setError('')\r\n\r\n    try {\r\n      if (!formData.name || !formData.price || formData.price <= 0) {\r\n        throw new Error('Product name and valid price are required')\r\n      }\r\n\r\n      const response = await put(`${PRODUCT.UPDATE}/${formData._id}`, {\r\n        name: formData.name,\r\n        short_description: formData.short_description,\r\n        description: formData.description,\r\n        price: parseFloat(formData.price),\r\n        compare_price: formData.compare_price ? parseFloat(formData.compare_price) : null,\r\n        cost_price: formData.cost_price ? parseFloat(formData.cost_price) : null,\r\n        sku: formData.sku,\r\n        quantity: parseInt(formData.quantity) || 0,\r\n        categories: formData.categories,\r\n        tags: formData.tags,\r\n        images: formData.images,\r\n        status: formData.status,\r\n        featured: formData.featured,\r\n        meta_title: formData.meta_title,\r\n        meta_description: formData.meta_description,\r\n        weight: formData.weight ? parseFloat(formData.weight) : null,\r\n        requires_shipping: formData.requires_shipping,\r\n        is_free_shipping: formData.is_free_shipping,\r\n        track_quantity: formData.track_quantity\r\n      })\r\n\r\n      if (!response.success) {\r\n        throw new Error(response.message || 'Failed to update product')\r\n      }\r\n\r\n      // Clear localStorage\r\n      localStorage.removeItem('editProduct')\r\n      \r\n      // Navigate back to products page\r\n      onNavigate && onNavigate('products')\r\n      \r\n    } catch (err) {\r\n      setError(err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleCancel = () => {\r\n    localStorage.removeItem('editProduct')\r\n    onNavigate && onNavigate('products')\r\n  }\r\n\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      {/* Page Header */}\r\n      <div className=\"row mb-4\">\r\n        <div className=\"col-12\">\r\n          <div className=\"d-flex justify-content-between align-items-center\">\r\n            <div>\r\n              <button \r\n                className=\"btn btn-outline-secondary me-3\"\r\n                onClick={handleCancel}\r\n              >\r\n                <i className=\"bi bi-arrow-left me-2\"></i>\r\n                Back to Products\r\n              </button>\r\n              <h2 className=\"fw-bold text-dark mb-0 d-inline\">Edit Product</h2>\r\n            </div>\r\n            <div className=\"d-flex gap-2\">\r\n              <button \r\n                type=\"button\" \r\n                className=\"btn btn-outline-secondary\"\r\n                onClick={handleCancel}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button \r\n                type=\"submit\" \r\n                form=\"editProductForm\"\r\n                className=\"btn btn-primary\"\r\n                disabled={loading}\r\n              >\r\n                {loading ? (\r\n                  <>\r\n                    <span className=\"spinner-border spinner-border-sm me-2\"></span>\r\n                    Updating...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <i className=\"bi bi-check-circle me-2\"></i>\r\n                    Update Product\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"alert alert-danger\" role=\"alert\">\r\n          <i className=\"bi bi-exclamation-triangle me-2\"></i>\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <form id=\"editProductForm\" onSubmit={handleSubmit}>\r\n        <div className=\"row\">\r\n          <div className=\"col-lg-8\">\r\n            {/* Basic Information */}\r\n            <div className=\"card border-0 shadow-sm mb-4\">\r\n              <div className=\"card-header bg-white border-bottom\">\r\n                <h5 className=\"mb-0 fw-semibold\">Basic Information</h5>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                <div className=\"mb-3\">\r\n                  <label className=\"form-label\">Product Name *</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"form-control\"\r\n                    name=\"name\"\r\n                    value={formData.name}\r\n                    onChange={handleInputChange}\r\n                    required\r\n                  />\r\n                </div>\r\n                \r\n                <div className=\"mb-3\">\r\n                  <label className=\"form-label\">Short Description</label>\r\n                  <textarea\r\n                    className=\"form-control\"\r\n                    name=\"short_description\"\r\n                    value={formData.short_description}\r\n                    onChange={handleInputChange}\r\n                    rows=\"3\"\r\n                  />\r\n                </div>\r\n                \r\n                <div className=\"mb-3\">\r\n                  <label className=\"form-label\">Description</label>\r\n                  <textarea\r\n                    className=\"form-control\"\r\n                    name=\"description\"\r\n                    value={formData.description}\r\n                    onChange={handleInputChange}\r\n                    rows=\"5\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Pricing */}\r\n            <div className=\"card border-0 shadow-sm mb-4\">\r\n              <div className=\"card-header bg-white border-bottom\">\r\n                <h5 className=\"mb-0 fw-semibold\">Pricing</h5>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-md-6\">\r\n                    <div className=\"mb-3\">\r\n                      <label className=\"form-label\">Price *</label>\r\n                      <div className=\"input-group\">\r\n                        <span className=\"input-group-text\">â‚¹</span>\r\n                        <input\r\n                          type=\"number\"\r\n                          step=\"0.01\"\r\n                          className=\"form-control\"\r\n                          name=\"price\"\r\n                          value={formData.price}\r\n                          onChange={handleInputChange}\r\n                          required\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"col-md-6\">\r\n                    <div className=\"mb-3\">\r\n                      <label className=\"form-label\">Compare at Price</label>\r\n                      <div className=\"input-group\">\r\n                        <span className=\"input-group-text\">â‚¹</span>\r\n                        <input\r\n                          type=\"number\"\r\n                          step=\"0.01\"\r\n                          className=\"form-control\"\r\n                          name=\"compare_price\"\r\n                          value={formData.compare_price}\r\n                          onChange={handleInputChange}\r\n                          placeholder=\"Original price\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Inventory */}\r\n            <div className=\"card border-0 shadow-sm mb-4\">\r\n              <div className=\"card-header bg-white border-bottom\">\r\n                <h5 className=\"mb-0 fw-semibold\">Inventory</h5>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-md-6\">\r\n                    <div className=\"mb-3\">\r\n                      <label className=\"form-label\">SKU</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        className=\"form-control\"\r\n                        name=\"sku\"\r\n                        value={formData.sku}\r\n                        onChange={handleInputChange}\r\n                        placeholder=\"Stock keeping unit\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"col-md-6\">\r\n                    <div className=\"mb-3\">\r\n                      <label className=\"form-label\">Quantity</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        className=\"form-control\"\r\n                        name=\"quantity\"\r\n                        value={formData.quantity}\r\n                        onChange={handleInputChange}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"col-lg-4\">\r\n            {/* Product Status */}\r\n            <div className=\"card border-0 shadow-sm mb-4\">\r\n              <div className=\"card-header bg-white border-bottom\">\r\n                <h5 className=\"mb-0 fw-semibold\">Product Status</h5>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                <div className=\"form-check form-switch mb-3\">\r\n                  <input\r\n                    className=\"form-check-input\"\r\n                    type=\"checkbox\"\r\n                    name=\"status\"\r\n                    checked={formData.status}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label className=\"form-check-label\">\r\n                    Published\r\n                  </label>\r\n                </div>\r\n                \r\n                <div className=\"form-check form-switch mb-3\">\r\n                  <input\r\n                    className=\"form-check-input\"\r\n                    type=\"checkbox\"\r\n                    name=\"featured\"\r\n                    checked={formData.featured}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label className=\"form-check-label\">\r\n                    Featured Product\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"form-check form-switch\">\r\n                  <input\r\n                    className=\"form-check-input\"\r\n                    type=\"checkbox\"\r\n                    name=\"track_quantity\"\r\n                    checked={formData.track_quantity}\r\n                    onChange={handleInputChange}\r\n                  />\r\n                  <label className=\"form-check-label\">\r\n                    Track Quantity\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Product Images */}\r\n            <div className=\"card border-0 shadow-sm mb-4\">\r\n              <div className=\"card-header bg-white border-bottom\">\r\n                <h5 className=\"mb-0 fw-semibold\">Product Images</h5>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                {formData.images && formData.images.length > 0 ? (\r\n                  <div className=\"row\">\r\n                    {formData.images.map((img, index) => (\r\n                      <div key={index} className=\"col-6 mb-2\">\r\n                        <img \r\n                          src={img} \r\n                          alt={`Product ${index + 1}`}\r\n                          className=\"img-fluid rounded\"\r\n                          style={{ height: '80px', width: '100%', objectFit: 'cover' }}\r\n                        />\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-center text-muted\">\r\n                    <i className=\"bi bi-image\" style={{ fontSize: '2rem' }}></i>\r\n                    <p>No images uploaded</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  )\r\n}\r\n"
        }
    ]
}